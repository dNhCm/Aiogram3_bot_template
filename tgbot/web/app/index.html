<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="styles/style.css">
    <title>Telegram Web App</title>
</head>
<body>
    <div id="hello">
        <h1>It's the Telegram Web App</h1>
        <p>Try to fill blanks using button below</p>
        <button id="to-form">Fill</button>
    </div>
    <form id="form">
        <h1>Body Fat Calculator</h1>
        <input type="text" placeholder="Name (full)" id="user-name">
        <input type="number" step="0.01" min="54" placeholder="Your Weight (kg)" id="user-weight">
        <input type="number" min="14" placeholder="Your Height (cm)" id="user-height">
        <p id="error"></p>
        <button id="send">Send to Bot</button>
    </form>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        let to_form = document.getElementById("to-form");
        let send = document.getElementById("send");

        tg.expand();

        to_form.addEventListener("click", () => {
            document.getElementById("hello").style.display = "none";
            document.getElementById("form").style.display = "block";
            document.getElementById("user-name").value = tg.initDataUnsafe.user.first_name + ' ' + tg.initDataUnsafe.user.last_name;
        })

        send.addEventListener("click", () => {
            let error = document.getElementById("error")
            error.value = '';

            let name = document.getElementById("user-name").value;
            let weight = parseFloat(document.getElementById("user-weight").value);
            let height = parseFloat(document.getElementById("user-height").value);

            if (name.length <= 1) {
                error.value = "Too short name ro be real(";
                return;
            }

            let data = {
                full_name: name,
                weight: weight,
                height: height
            };

            tg.sendData(JSON.stringify(data));

            tg.close();
        })
    </script>
</body>
</html>